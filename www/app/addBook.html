<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>Книга [Добавить книгу]</title>
    <link rel="stylesheet" href="css/main.css">
    <script src="js/close-modal-entry.js" defer></script>
</head>
<body>
<div class="page">
    <header class="header">
        <nav>
            <div>
                <a href="index.html" class="linkImage" title="На главную страницу"><img src="img/logo_mini.jpeg"/></a>
                <a href="rider.html">Читалка</a>
                <div class="dropdown">
                    <button class="dropbtn">Выпадающее</button>
                    <div class="dropdown-content">
                        <a href="str2.html">Книга подробно</a>
                        <a href="myLibrary.html">Моя библиотека</a>
                        <a href="addBook.html">Добавит свою книгу</a>
                        <a href="addChapter.html">Добавит глову в свою книгу</a>
                        <a href="editChapter.html">Редактировать главу</a>
                        <a href="personalAccount.html">Личный кабинет читателя</a>
                        <a href="personalAccountWriter.html">Личный кабинеит писателя</a>
                        <a href="writerPage.html">страница писателя</a>
                    </div>
                </div>
                <div class="control-unit">
                    <div class="search">
                        <input type="text" placeholder="поиск по автору или книге">
                        <button>Поиск</button>
                    </div>
                    <a href="#" title="Начитающие авторы">Новички</a>
                    <a href="#" title="Популярные авторы">Мэтры</a>
                </div>
            </div>
            <div>
                <a href="reg.html">регистрация</a>
                <a href="#modal-entry">вход</a>
            </div>
        </nav>
        <!-- Модальное окно авторизации -->
        <div class="css-modal-target" id="modal-entry">
            <div class="cmt">
                <a href="#close" class="css-modal-close" id="close-modal-entry" title="Закрыть">&times;</a>
                <form>
                    <div class="formEmpty">
                        <h3>ВХОД</h3>
                        <input type="text" id="login" placeholder="логин">
                        <input type="password" placeholder="Пароль" required>
                        <a href="forgetPassword.html">Забыли пароль</a>
                        <button type="submit">Вход</button>
                    </div>
                </form>
            </div>
        </div>
        <!-- Конец Модальное окна -->
    </header>
    <main class="main">
        <div class="add-book">
            <form>
                <div class="cart-book">
                    <div class="add-img">
                        <div>
                            Обложка книги
                            Размер изображения должен быть не менее 200 пикселей в ширину и 285 в высоту.
                            Максимальный размер файла: 5 мб.
                        </div>
                        <div class="block-img">
                            <img id="e4r45t" src="" alt="Обложка">
                            <input id="riss" type="file" accept="image/png, image/jpeg" />
                        </div>
                        <label for="riss">загрузить обложку</label>
                    </div>

                    <div class="block-input">
                        <div>Название книги</div>
                        <div>Выбери жанр книги</div>
                        <div>Тэги для поиска через пробел. Максимум 5 тегов.</div>
                        <div>Краткое описание книги. Расскажите о чем она. Максимум 400 символов.</div>
                        <div>Книга входит в цикл</div>
                        <div>
                            <button type="reset">Очистить</button>
                            <button type="submit">Сохранить</button>
                        </div>
                    </div>
                </div>
            </form>
        </div>
    </main>
    <footer class="footer">Нижний блок</footer>
</div>
<script>
    const image = document.getElementById("e4r45t");
    const fileInput = document.getElementById("riss");

    fileInput.onchange = (e) => {
        // 1. Проверяем, что файл выбран
        if (!fileInput.files || !fileInput.files[0]) {
            return;
        }

        const file = fileInput.files[0];

        // 2. Проверяем тип файла
        if (!file.type.startsWith('image/')) {
            alert('Пожалуйста, выберите изображение (PNG или JPEG)');
            fileInput.value = '';
            return;
        }

        // 3. Проверяем размер файла (максимум 5 МБ)
        const maxSize = 5 * 1024 * 1024; // 5 МБ в байтах
        if (file.size > maxSize) {
            alert('Файл слишком большой. Максимальный размер — 5 МБ.');
            fileInput.value = '';
            return;
        }

        // 4. Создаём временный URL для предпросмотра
        const objectURL = URL.createObjectURL(file);

        // 5. Загружаем изображение для проверки размеров
        const img = new Image();
        img.onload = () => {
            const targetWidth = 200;
            const targetHeight = 280;
            const tolerance = 0.10; // 10%

            // Вычисляем допустимые границы
            const minWidth = targetWidth * (1 - tolerance);
            const maxWidth = targetWidth * (1 + tolerance);
            const minHeight = targetHeight * (1 - tolerance);
            const maxHeight = targetHeight * (1 + tolerance);

            const actualWidth = img.naturalWidth;
            const actualHeight = img.naturalHeight;

            // Проверяем, попадают ли размеры в диапазон ±10%
            if (
                actualWidth < minWidth ||
                actualWidth > maxWidth ||
                actualHeight < minHeight ||
                actualHeight > maxHeight
            ) {
                alert(
                    `Размеры изображения должны быть близки к 200×280 px (допуск ±10%).\n` +
                    `Ваши размеры: ${actualWidth}×${actualHeight} px.\n` +
                    `Допустимый диапазон: ${minWidth.toFixed(0)}–${maxWidth.toFixed(0)} px по ширине и ` +
                    `${minHeight.toFixed(0)}–${maxHeight.toFixed(0)} px по высоте.`
                );
                URL.revokeObjectURL(objectURL); // Очищаем URL
                fileInput.value = ''; //Очищаем поле
                return;
            }

            // Если всё ок — отображаем изображение
            image.src = objectURL;
            image.style.display = 'block';

            // Освобождаем URL после загрузки (опционально)
            image.onload = () => URL.revokeObjectURL(objectURL);
        };

        img.onerror = () => {
            alert('Не удалось загрузить изображение. Проверьте файл.');
            URL.revokeObjectURL(objectURL);
            fileInput.value = '';
        };

        img.src = objectURL; // Запускаем загрузку
    };
</script>
</body>
</html>